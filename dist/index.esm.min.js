const t=String.fromCharCode,e=String.fromCodePoint;var i=function(){let e=2048,i=Array(e);i[e]='\0';while(e>128)i[e-=1]=t(192|e>>6&31,128|63&e);while(e>0)i[e-=1]=t(e);return i}();const s='',r='ࠀ';class MsgPackError extends Error{}class DecodingFailed extends MsgPackError{static fromOffset(t){return new this(`Cannot decode data with byte-header in position ${t}`)}}class EncodingFailed extends MsgPackError{static withValue(t){return new this(`Could not encode: ${typeof t}`)}}class InsufficientData extends DecodingFailed{static unexpectedLength(t,e){return new this(`Not enough data to decode: expected length ${t}, got ${e}`)}}var n=function(){let t=257,e=Array(t),i=String.fromCharCode;while(t>0)e[t-=1]=i(255&t);return e}();const h=new Float32Array(1),o=new Float64Array(1);function c(t){const e=t.length;return 32>e?n[160|e]+t:256>e?'Ù'+n[e]+t:65536>e?'Ú'+n[e>>8]+n[255&e]+t:'Û'+n[e>>24&255]+n[e>>16&255]+n[e>>8&255]+n[255&e]+t}function d(t,e){return n[t>>24&255]+n[t>>16&255]+n[t>>8&255]+n[255&t]+n[e>>24&255]+n[e>>16&255]+n[e>>8&255]+n[255&e]}const u=Math.fround,a=new Uint8Array(h.buffer),l=new Uint8Array(o.buffer);function f(t){return t===u(t)?(h[0]=t,'Ê'+n[a[3]]+n[a[2]]+n[a[1]]+n[a[0]]):(o[0]=t,'Ë'+n[l[7]]+n[l[6]]+n[l[5]]+n[l[4]]+n[l[3]]+n[l[2]]+n[l[1]]+n[l[0]])}function b(t){return h[0]=t,'Ê'+n[a[3]]+n[a[2]]+n[a[1]]+n[a[0]]}function g(t){return o[0]=t,'Ë'+n[l[7]]+n[l[6]]+n[l[5]]+n[l[4]]+n[l[3]]+n[l[2]]+n[l[1]]+n[l[0]]}class Ext{constructor(t,e){this.type=t,this.bin=e}}const w=Array.isArray,y=Object.keys,U='boolean',x='number',E='object',p='string';class Encoder{constructor({handler:t=function(t){throw EncodingFailed.withValue(t)},float:e="64",objectKeys:i="ascii",codecs:s=!1}={}){var r;this.u=t.bind(this),this.encodeFloat='64'===(r=e)?g:'32'===r?b:f,this.encodeBigInt=this.encodeInt,this.e='ascii'===i?c:this.encodeStr,this.c=s}encode(t){switch(typeof t){case p:return this.encodeStr(t);case x:return t%1==0?this.encodeInt(t):this.encodeFloat(t);case E:if(null===t)return'À';if(w(t))return this.encodeArray(t);if(t.constructor==ArrayBuffer)return this.encodeBin(t);if(t.constructor==Ext)return this.encodeExt(t.type,t.bin);if(this.c){let e,i=this.c.length;while(i>0)if(null!==(e=this.c[i-=1].encode(this,t)))return e}return this.encodeObject(t);case U:return t?'Ã':'Â';default:return this.u(t)}}encodeNil(){return'À'}encodeBool(t){return t?'Ã':'Â'}encodeInt(t){return 0>t?t>-33?n[255&t]:t>-129?'Ð'+n[255&t]:t>-32769?'Ñ'+n[t>>8&255]+n[255&t]:t>-2147483649?'Ò'+n[t>>24&255]+n[t>>16&255]+n[t>>8&255]+n[255&t]:t>-9007199254740992?'Ó'+d((t/4294967296>>0)-1,t>>>0):'Ëÿð\0\0\0\0\0\0':128>t?n[t]:256>t?'Ì'+n[t]:65536>t?'Í'+n[t>>8]+n[255&t]:4294967296>t?'Î'+n[t>>24&255]+n[t>>16&255]+n[t>>8&255]+n[255&t]:9007199254740992>t?'Ï'+d(t>>>11|1,t):'Ëð\0\0\0\0\0\0'}encodeStr(e){let h=e.length;if(0===h)return' ';const o=function(e){let n='';for(let h,o=0;o<e.length;o++)h=e[o],s>h?n+=h:r>h?n+=i[h.charCodeAt(0)]:(h=h.codePointAt(0),n+=t(224|h>>12&15,128|h>>6&63,128|63&h));return n}(e);return 32>(h=o.length)?n[160|h]+o:256>h?'Ù'+n[h]+o:65536>h?'Ú'+n[h>>8]+n[255&h]+o:'Û'+n[h>>24&255]+n[h>>16&255]+n[h>>8&255]+n[255&h]+o}encodeBin(t){const e=t.length;if(0===e)return'Ä\0';let i='';for(let s=0;e>s;s++)i+=n[t[s]];return 65536>e?'Å'+n[e>>8]+n[255&e]+i:'Æ'+n[e>>24&255]+n[e>>16&255]+n[e>>8&255]+n[255&e]+i}encodeArray(t){const e=t.length;if(0===e)return'';let i;i=16>e?n[144|e]:65536>e?'Ü'+n[e>>8]+n[255&e]:'Ý'+n[e>>24&255]+n[e>>16&255]+n[e>>8&255]+n[255&e];for(let s=0;e>s;s++)i+=this.encode(t[s]);return i}encodeObject(t){const e=y(t),i=e.length;if(0===i)return'';let s;s=16>i?n[128|i]:65536>i?'Þ'+n[i>>8]+n[255&i]:'ß'+n[i>>24&255]+n[i>>16&255]+n[i>>8&255]+n[255&i];for(let r,n=0;i>n;n++)r=e[n],s+=this.e(r),s+=this.encode(t[r]);return s}encodeExt(t,e){const i=n[127&t]+e,s=e.length;switch(s){case 1:return'Ô'+i;case 2:return'Õ'+i;case 4:return'Ö'+i;case 8:return'×'+i;case 16:return'Ø'+i}return 256>s?'Ç'+n[s]+i:65536>s?'È'+n[s>>8]+n[255&s]+i:'É'+n[s>>24&255]+n[s>>16&255]+n[s>>8&255]+n[255&s]+i}}const A=new Uint32Array(h.buffer),I=new Uint32Array(o.buffer);class Decoder{constructor({handler:t=function(t){if(0===t)throw DecodingFailed.fromOffset(this.offset);throw InsufficientData.unexpectedLength(t,this.length-this.offset)},codecs:e=!1}={}){this.u=t.bind(this),this.c=!!e&&function(t){const e=new Map;let i,s=t.length;while(s>0)i=t[s-=1],e.set(i.type,i);return e}(e),this.b=null,this.o=0,this.l=0}decode(t,e=0,i=t.length){return this.b=t,this.o=e,this.l=e+i,this.parse()}parse(){if(this.l<this.o+1)return this.u(1);const t=this.b[this.o];if(this.o+=1,192>t)return 128>t?t:144>t?128===t?{}:this.decodeMap(15&t):160>t?144===t?[]:this.decodeArray(15&t):160===t?'':this.decodeStr(31&t);if(t>223)return t-256;switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 202:return this.decodeFloat32();case 203:return this.decodeFloat64();case 204:return this.decodeUint8();case 205:return this.decodeUint16();case 206:return this.decodeUint32();case 207:return this.decodeUint64();case 208:return this.decodeInt8();case 209:return this.decodeInt16();case 210:return this.decodeInt32();case 211:return this.decodeInt64();case 217:return this.decodeStr(this.decodeUint8());case 218:return this.decodeStr(this.decodeUint16());case 219:return this.decodeStr(this.decodeUint32());case 220:return this.decodeArray(this.decodeUint16());case 221:return this.decodeArray(this.decodeUint32());case 222:return this.decodeMap(this.decodeUint16());case 223:return this.decodeMap(this.decodeUint32());case 196:return this.decodeBin(this.decodeUint8());case 197:return this.decodeBin(this.decodeUint16());case 198:return this.decodeBin(this.decodeUint32());case 212:return this.decodeExt(1);case 213:return this.decodeExt(2);case 214:return this.decodeExt(4);case 215:return this.decodeExt(8);case 216:return this.decodeExt(16);case 199:return this.decodeExt(this.decodeUint8());case 200:return this.decodeExt(this.decodeUint16());case 201:return this.decodeExt(this.decodeUint32());default:return this.u(0)}}decodeFloat32(){return this.l<this.o+4?this.u(4):(A[0]=16777216*this.b[this.o]|this.b[this.o+1]<<16|this.b[this.o+2]<<8|this.b[this.o+3],this.o+=4,h[0])}decodeFloat64(){return this.l<this.o+8?this.u(8):(I[1]=16777216*this.b[this.o]|this.b[this.o+1]<<16|this.b[this.o+2]<<8|this.b[this.o+3],I[0]=16777216*this.b[this.o+4]|this.b[this.o+5]<<16|this.b[this.o+6]<<8|this.b[this.o+7],this.o+=8,o[0])}decodeUint8(){if(this.l<this.o+1)return this.u(1);const t=this.b[this.o];return this.o+=1,t}decodeUint16(){if(this.l<this.o+2)return this.u(2);const t=this.b[this.o]<<8|this.b[this.o+1];return this.o+=2,t}decodeUint32(){if(this.l<this.o+4)return this.u(4);const t=16777216*this.b[this.o]+(this.b[this.o+1]<<16|this.b[this.o+2]<<8|this.b[this.o+3]);return this.o+=4,t}decodeUint64(){if(this.l<this.o+8)return this.u(8);const t=16777216*this.b[this.o]+4294967296*(this.b[this.o+1]<<16|this.b[this.o+2]<<8|this.b[this.o+3])+16777216*this.b[this.o+4]+(this.b[this.o+5]<<16|this.b[this.o+6]<<8|this.b[this.o+7]);return this.o+=8,t}decodeInt8(){if(this.l<this.o+1)return this.u(1);const t=this.b[this.o]-256;return this.o+=1,t}decodeInt16(){if(this.l<this.o+2)return this.u(2);const t=(this.b[this.o]<<8|this.b[this.o+1])-65536;return this.o+=2,t}decodeInt32(){if(this.l<this.o+4)return this.u(4);const t=this.b[this.o]<<24|this.b[this.o+1]<<16|this.b[this.o+2]<<8|this.b[this.o+3];return this.o+=4,t}decodeInt64(){if(this.l<this.o+8)return this.u(8);const t=4294967296*(this.b[this.o]<<24|this.b[this.o+1]<<16|this.b[this.o+2]<<8|this.b[this.o+3])+16777216*this.b[this.o+4]+(this.b[this.o+5]<<16|this.b[this.o+6]<<8|this.b[this.o+7]);return this.o+=8,t}decodeBin(t){return this.l<this.o+t?this.u(t):this.b.slice(this.o,this.o+=t)}decodeStr(i){return this.l<this.o+i?this.u(i):function(i,s,r){let n,h='';while(r>s)128>(n=i[s])?(h+=t(n),s+=1):224>n?(h+=t((31&n)<<6|63&i[s+1]),s+=2):(h+=e((15&n)<<12|(63&i[s+1])<<6|63&i[s+2]),s+=3);return h}(this.b,this.o,this.o+=i)}decodeArray(t){const e=Array(t);for(let i=0;t>i;i++)e[i]=this.parse();return e}decodeMap(t){const e={};while(t>0)t-=1,e[this.parse()]=this.parse();return e}decodeExt(t){if(this.l<this.o+t)return this.u(t);const e=this.b[this.o];if(this.o+=1,this.c){const i=this.c.get(e);if(void 0!==i)return i.decode(this,t)}return new Ext(e,this.b.slice(this.o,this.o+=t))}}export{Encoder,Decoder};
