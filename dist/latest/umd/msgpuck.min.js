var t,e;t=this,e=function(t){'use strict';const e=String.fromCharCode,s=(((t=257)=>{const s=[];while(t>0)s[t-=1]=e(255&t)})(),((t=2048)=>{const s=[];s[t]='\0';while(t>128)s[t-=1]=e(192|t>>6&31,128|63&t);while(t>0)s[t-=1]=e(t);return s})()),i=String.fromCodePoint,r=(t,s,r)=>{let h,n='';while(r>s)128>(h=t[s])?(n+=e(h),s+=1):224>h?(n+=e((31&h)<<6|63&t[s+1]),s+=2):(n+=i((15&h)<<12|(63&t[s+1])<<6|63&t[s+2]),s+=3);return n},h=t=>{let i='';for(let r,h=0;h<t.length;h++)"">(r=t[h])?i+=r:"ࠀ">r?i+=s[r.charCodeAt(0)]:(r=r.codePointAt(0),i+=e(224|r>>12&15,128|r>>6&63,128|63&r));return i};class MsgPackError extends Error{constructor(t){super(t),Error.captureStackTrace(this,new.target),this.name=new.target.name,this.message=t}}class DecodingFailed extends MsgPackError{static fromOffset(t){return new this(`Cannot decode data with byte-header in position ${t}`)}}class EncodingFailed extends MsgPackError{static withValue(t){return new this(`Could not encode: ${typeof t}`)}}class InsufficientData extends DecodingFailed{static unexpectedLength(t,e){return new this(`Not enough data to decode: expected length ${t}, got ${e}`)}}function n(t){if(0===t)throw DecodingFailed.fromOffset(this.offset);throw InsufficientData.unexpectedLength(t,this.length-this.offset)}const c=t=>{throw EncodingFailed.withValue(t)},d=new Uint8Array(8),u=new Float32Array(1),o=new Float64Array(1),a=new BigUint64Array(1),f=new BigInt64Array(1);function l(t,e){this.type=t,this.bin=e}const g=new Uint32Array(u.buffer),w=new Uint32Array(o.buffer),y=new Uint32Array(a.buffer),b=new Int32Array(f.buffer),p=t=>{const e=new Map;let s,i=t.length;while(i>0)s=t[i-=1],e.set(s.type,s);return e},A=t=>{const s=t.length;return 32>s?e(160|s)+t:256>s?'Ù'+e(s)+t:65536>s?'Ú'+e(s>>8)+e(255&s)+t:'Û'+e(s>>24&255)+e(s>>16&255)+e(s>>8&255)+e(255&s)+t},m=(t,s)=>e(t>>24&255)+e(t>>16&255)+e(t>>8&255)+e(255&t)+e(s>>24&255)+e(s>>16&255)+e(s>>8&255)+e(255&s),x=Math.fround,E=new Uint8Array(u.buffer),F=new DataView(d.buffer),I=t=>t===x(t)?(u[0]=t,'Ê'+e(E[3])+e(E[2])+e(E[1])+e(E[0])):(F.setFloat64(0,t),'Ë'+e(d[0])+e(d[1])+e(d[2])+e(d[3])+e(d[4])+e(d[5])+e(d[6])+e(d[7])),j=t=>(u[0]=t,'Ê'+e(E[3])+e(E[2])+e(E[1])+e(E[0])),k=t=>(F.setFloat64(0,t),'Ë'+e(d[0])+e(d[1])+e(d[2])+e(d[3])+e(d[4])+e(d[5])+e(d[6])+e(d[7])),B=t=>'64'===t?k:'32'===t?j:I,C=new Uint8Array(a.buffer),D=new Int8Array(f.buffer),U='boolean',M='number',O='object',P='string',S='bigint';t.Decoder=class Decoder{constructor({handler:t=n,codecs:e=!1}={}){this.a=t.bind(this),this.b=e&&p(e),this.c=null,this.d=0,this.e=0}decode(t,e=0,s=t.length){return this.c=t,this.d=e,this.e=e+s,this.f()}f(){if(this.e<=this.d)return this.a(1);const t=this.c[this.d];if(this.d+=1,192>t)return 128>t?t:144>t?128===t?{}:this.r(15&t):160>t?144===t?[]:this.q(15&t):160===t?'':this.s(31&t);if(t>223)return t-256;switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 202:return this.g();case 203:return this.h();case 204:return this.m();case 205:return this.n();case 206:return this.o();case 207:return this.p();case 208:return this.i();case 209:return this.j();case 210:return this.k();case 211:return this.l();case 217:return this.s(this.m());case 218:return this.s(this.n());case 219:return this.s(this.o());case 220:return this.q(this.n());case 221:return this.q(this.o());case 222:return this.r(this.n());case 223:return this.r(this.o());case 196:return this.t(this.m());case 197:return this.t(this.n());case 198:return this.t(this.o());case 212:return this.u(1);case 213:return this.u(2);case 214:return this.u(4);case 215:return this.u(8);case 216:return this.u(16);case 199:return this.u(this.m());case 200:return this.u(this.n());case 201:return this.u(this.o());default:return this.a(0)}}g(){return this.e<this.d+4?this.a(4):(g[0]=16777216*this.c[this.d]|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],this.d+=4,u[0])}h(){return this.e<this.d+8?this.a(8):(w[1]=16777216*this.c[this.d]|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],w[0]=16777216*this.c[this.d+4]|this.c[this.d+5]<<16|this.c[this.d+6]<<8|this.c[this.d+7],this.d+=8,o[0])}m(){if(this.e<=this.d)return this.a(1);const t=this.c[this.d];return this.d+=1,t}n(){if(this.e<this.d+2)return this.a(2);const t=this.c[this.d]<<8|this.c[this.d+1];return this.d+=2,t}o(){if(this.e<this.d+4)return this.a(4);const t=16777216*this.c[this.d]+(this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3]);return this.d+=4,t}p(){return this.e<this.d+8?this.a(8):(y[1]=this.c[this.d]<<24|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],y[0]=this.c[this.d+4]<<24|this.c[this.d+5]<<16|this.c[this.d+6]<<8|this.c[this.d+7],this.d+=8,a[0])}i(){if(this.e<=this.d)return this.a(1);const t=this.c[this.d]-256;return this.d+=1,t}j(){if(this.e<this.d+2)return this.a(2);const t=(this.c[this.d]<<8|this.c[this.d+1])-65536;return this.d+=2,t}k(){if(this.e<this.d+4)return this.a(4);const t=this.c[this.d]<<24|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3];return this.d+=4,t}l(){return this.e<this.d+8?this.a(8):(b[1]=this.c[this.d]<<24|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],b[0]=this.c[this.d+4]<<24|this.c[this.d+5]<<16|this.c[this.d+6]<<8|this.c[this.d+7],this.d+=8,f[0])}t(t){if(this.e<this.d+t)return this.a(t);const e=this.c.byteOffset+this.d;return this.d+=t,new Uint8Array(this.c.buffer,e,t)}s(t){return this.e<this.d+t?this.a(t):r(this.c,this.d,this.d+=t)}q(t){const e=[];for(let s=0;t>s;s++)e[s]=this.f();return e}r(t){const e={};while(t>0)t-=1,e[this.f()]=this.f();return e}u(t){if(this.e<this.d+t)return this.a(t);const e=this.c[this.d];if(this.d+=1,this.b){const s=this.b.get(e);if(void 0!==s)return s.decode(this,t)}return new l(e,this.c.slice(this.d,this.d+=t))}},t.Encoder=class Encoder{constructor({handler:t=c,codecs:e=!1,float:s="64",objectKey:i="ascii",objectCase:r=Object.keys,arrayCase:h=Array.isArray}={}){this.b=t.bind(this),this.a=e,this.encodeFloat=B(s),this.c='ascii'===i?A:this.encodeStr,this.d=r,this.e=h}encode(t){switch(typeof t){case P:return this.encodeStr(t);case M:return t%1==0?this.encodeInt(t):this.encodeFloat(t);case O:if(null===t)return'À';if(this.e(t))return this.encodeArray(t);if(t.constructor==ArrayBuffer)return this.encodeBin(t);if(t.constructor==l)return this.encodeExt(t.type,t.bin);if(this.a){let e,s=this.a.length;while(s>0)if(null!==(e=this.a[s-=1].encode(this,t)))return e}return this.encodeObject(t);case U:return t?'Ã':'Â';case S:return t>4294967295||-2147483648>t?this.encodeBigInt(t):this.encodeInt(+t);default:return this.b(t)}}encodeNil(){return'À'}encodeBool(t){return t?'Ã':'Â'}encodeInt(t){return 0>t?t>-33?e(255&t):t>-129?'Ð'+e(255&t):t>-32769?'Ñ'+e(t>>8&255)+e(255&t):t>-2147483649?'Ò'+e(t>>24&255)+e(t>>16&255)+e(t>>8&255)+e(255&t):t>-9007199254740992?'Ó'+m((t/4294967296>>0)-1,t>>>0):'Ëÿð\0\0\0\0\0\0':128>t?e(t):256>t?'Ì'+e(t):65536>t?'Í'+e(t>>8)+e(255&t):4294967296>t?'Î'+e(t>>24&255)+e(t>>16&255)+e(t>>8&255)+e(255&t):9007199254740992>t?'Ï'+m(t>>>11|1,t):'Ëð\0\0\0\0\0\0'}encodeBigInt(t){return 0>t?(f[0]=t,'Ó'+e(255&D[7])+e(255&D[6])+e(255&D[5])+e(255&D[4])+e(255&D[3])+e(255&D[2])+e(255&D[1])+e(255&D[0])):(a[0]=t,'Ï'+e(C[7])+e(C[6])+e(C[5])+e(C[4])+e(C[3])+e(C[2])+e(C[1])+e(C[0]))}encodeStr(t){let s=t.length;if(0===s)return' ';const i=h(t);return 32>(s=i.length)?e(160|s)+i:256>s?'Ù'+e(s)+i:65536>s?'Ú'+e(s>>8)+e(255&s)+i:'Û'+e(s>>24&255)+e(s>>16&255)+e(s>>8&255)+e(255&s)+i}encodeBin(t){const s=t.length;if(0===s)return'Ä\0';let i='';for(let r=0;s>r;r++)i+=e(t[r]);return 256>s?'Ä'+e(s)+i:65536>s?'Å'+e(s>>8)+e(255&s)+i:'Æ'+e(s>>24&255)+e(s>>16&255)+e(s>>8&255)+e(255&s)+i}encodeArray(t){const s=t.length;if(0===s)return'';let i;i=16>s?e(144|s):65536>s?'Ü'+e(s>>8)+e(255&s):'Ý'+e(s>>24&255)+e(s>>16&255)+e(s>>8&255)+e(255&s);for(let e=0;s>e;e++)i+=this.encode(t[e]);return i}encodeObject(t){const s=this.d(t),i=s.length;if(0===i)return'';let r;r=16>i?e(128|i):65536>i?'Þ'+e(i>>8)+e(255&i):'ß'+e(i>>24&255)+e(i>>16&255)+e(i>>8&255)+e(255&i);for(let e,h=0;i>h;h++)e=s[h],r+=this.c(e),r+=this.encode(t[e]);return r}encodeExt(t,s){const i=e(127&t)+s,r=s.length;switch(r){case 1:return'Ô'+i;case 2:return'Õ'+i;case 4:return'Ö'+i;case 8:return'×'+i;case 16:return'Ø'+i}return 256>r?'Ç'+e(r)+i:65536>r?'È'+e(r>>8)+e(255&r)+i:'É'+e(r>>24&255)+e(r>>16&255)+e(r>>8&255)+e(255&r)+i}},t.Ext=l},'object'==typeof exports&&'undefined'!=typeof module?e(exports):'function'==typeof define&&define.amd?define(['exports'],e):e((t=t||self).MsgPuck={});
