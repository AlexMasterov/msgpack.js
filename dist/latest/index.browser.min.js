const t=String.fromCharCode,s=String.fromCodePoint;var e=function(){let s=2048,e=[];e[s]='\0';while(s>128)e[s-=1]=t(192|s>>6&31,128|63&s);while(s>0)e[s-=1]=t(s);return e}();const i='',r='ࠀ';class MsgPackError extends Error{constructor(t){super(t),Error.captureStackTrace(this,new.target),this.name=new.target.name,this.message=t}}class DecodingFailed extends MsgPackError{static fromOffset(t){return new this(`Cannot decode data with byte-header in position ${t}`)}}class EncodingFailed extends MsgPackError{static withValue(t){return new this(`Could not encode: ${typeof t}`)}}class InsufficientData extends DecodingFailed{static unexpectedLength(t,s){return new this(`Not enough data to decode: expected length ${t}, got ${s}`)}}function h(t){if(0===t)throw DecodingFailed.fromOffset(this.offset);throw InsufficientData.unexpectedLength(t,this.length-this.offset)}function n(t){throw EncodingFailed.withValue(t)}const c=String.fromCharCode,u=new Uint8Array(8),d=new Float32Array(1),o=new Float64Array(1),a=new BigUint64Array(1),f=new BigInt64Array(1);function l(t){const s=t.length;return 32>s?c(160|s)+t:256>s?'Ù'+c(s)+t:65536>s?'Ú'+c(s>>8)+c(255&s)+t:'Û'+c(s>>24&255)+c(s>>16&255)+c(s>>8&255)+c(255&s)+t}function g(t,s){return c(t>>24&255)+c(t>>16&255)+c(t>>8&255)+c(255&t)+c(s>>24&255)+c(s>>16&255)+c(s>>8&255)+c(255&s)}const w=Math.fround,b=new Uint8Array(d.buffer),y=new DataView(u.buffer);function A(t){return t===w(t)?(d[0]=t,'Ê'+c(b[3])+c(b[2])+c(b[1])+c(b[0])):(y.setFloat64(0,t),'Ë'+c(u[0])+c(u[1])+c(u[2])+c(u[3])+c(u[4])+c(u[5])+c(u[6])+c(u[7]))}function p(t){return d[0]=t,'Ê'+c(b[3])+c(b[2])+c(b[1])+c(b[0])}function m(t){return y.setFloat64(0,t),'Ë'+c(u[0])+c(u[1])+c(u[2])+c(u[3])+c(u[4])+c(u[5])+c(u[6])+c(u[7])}function F(t,s){this.type=t,this.bin=s}const E=new Uint8Array(a.buffer),x=new Int8Array(f.buffer),C='boolean',I='number',B='object',j='string',D='bigint';class Encoder{constructor({handler:t=n,codecs:s=!1,float:e="64",objectKey:i="ascii",objectCase:r=Object.keys,arrayCase:h=Array.isArray}={}){var c;this.b=t.bind(this),this.a=s,this.encodeFloat='64'===(c=e)?m:'32'===c?p:A,this.c='ascii'===i?l:this.encodeStr,this.d=r,this.e=h}encode(t){switch(typeof t){case j:return this.encodeStr(t);case I:return t%1==0?this.encodeInt(t):this.encodeFloat(t);case B:if(null===t)return'À';if(this.e(t))return this.encodeArray(t);if(isBuffer(t))return this.encodeBin(t);if(t.constructor==F)return this.encodeExt(t.type,t.bin);if(this.a){let s,e=this.a.length;while(e>0)if(null!==(s=this.a[e-=1].encode(this,t)))return s}return this.encodeObject(t);case C:return t?'Ã':'Â';case D:return t>4294967295||-2147483648>t?this.encodeBigInt(t):this.encodeInt(+t);default:return this.b(t)}}encodeNil(){return'À'}encodeBool(t){return t?'Ã':'Â'}encodeInt(t){return 0>t?t>-33?c(255&t):t>-129?'Ð'+c(255&t):t>-32769?'Ñ'+c(t>>8&255)+c(255&t):t>-2147483649?'Ò'+c(t>>24&255)+c(t>>16&255)+c(t>>8&255)+c(255&t):t>-9007199254740992?'Ó'+g((t/4294967296>>0)-1,t>>>0):'Ëÿð\0\0\0\0\0\0':128>t?c(t):256>t?'Ì'+c(t):65536>t?'Í'+c(t>>8)+c(255&t):4294967296>t?'Î'+c(t>>24&255)+c(t>>16&255)+c(t>>8&255)+c(255&t):9007199254740992>t?'Ï'+g(t>>>11|1,t):'Ëð\0\0\0\0\0\0'}encodeBigInt(t){return 0>t?(f[0]=t,'Ó'+c(255&x[7])+c(255&x[6])+c(255&x[5])+c(255&x[4])+c(255&x[3])+c(255&x[2])+c(255&x[1])+c(255&x[0])):(a[0]=t,'Ï'+c(E[7])+c(E[6])+c(E[5])+c(E[4])+c(E[3])+c(E[2])+c(E[1])+c(E[0]))}encodeStr(s){let h=s.length;if(0===h)return' ';const n=function(s){let h='';for(let n,c=0;c<s.length;c++)n=s[c],i>n?h+=n:r>n?h+=e[n.charCodeAt(0)]:(n=n.codePointAt(0),h+=t(224|n>>12&15,128|n>>6&63,128|63&n));return h}(s);return 32>(h=n.length)?c(160|h)+n:256>h?'Ù'+c(h)+n:65536>h?'Ú'+c(h>>8)+c(255&h)+n:'Û'+c(h>>24&255)+c(h>>16&255)+c(h>>8&255)+c(255&h)+n}encodeBin(t){const s=t.length;if(0===s)return'Ä\0';let e='';for(let i=0;s>i;i++)e+=c(t[i]);return 256>s?'Ä'+c(s)+e:65536>s?'Å'+c(s>>8)+c(255&s)+e:'Æ'+c(s>>24&255)+c(s>>16&255)+c(s>>8&255)+c(255&s)+e}encodeArray(t){const s=t.length;if(0===s)return'';let e;e=16>s?c(144|s):65536>s?'Ü'+c(s>>8)+c(255&s):'Ý'+c(s>>24&255)+c(s>>16&255)+c(s>>8&255)+c(255&s);for(let i=0;s>i;i++)e+=this.encode(t[i]);return e}encodeObject(t){const s=this.d(t),e=s.length;if(0===e)return'';let i;i=16>e?c(128|e):65536>e?'Þ'+c(e>>8)+c(255&e):'ß'+c(e>>24&255)+c(e>>16&255)+c(e>>8&255)+c(255&e);for(let r,h=0;e>h;h++)r=s[h],i+=this.c(r),i+=this.encode(t[r]);return i}encodeExt(t,s){const e=c(127&t)+s,i=s.length;switch(i){case 1:return'Ô'+e;case 2:return'Õ'+e;case 4:return'Ö'+e;case 8:return'×'+e;case 16:return'Ø'+e}return 256>i?'Ç'+c(i)+e:65536>i?'È'+c(i>>8)+c(255&i)+e:'É'+c(i>>24&255)+c(i>>16&255)+c(i>>8&255)+c(255&i)+e}}const k=new Uint32Array(d.buffer),S=new Uint32Array(o.buffer),U=new Uint32Array(a.buffer),O=new Int32Array(f.buffer);class Decoder{constructor({handler:t=h,codecs:s=!1}={}){this.a=t.bind(this),this.b=s&&function(t){const s=new Map;let e,i=t.length;while(i>0)e=t[i-=1],s.set(e.type,e);return s}(s),this.c=null,this.d=0,this.e=0}decode(t,s=0,e=t.length){return this.c=t,this.d=s,this.e=s+e,this.f()}f(){if(this.e<=this.d)return this.a(1);const t=this.c[this.d];if(this.d+=1,192>t)return 128>t?t:144>t?128===t?{}:this.r(15&t):160>t?144===t?[]:this.q(15&t):160===t?'':this.s(31&t);if(t>223)return t-256;switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 202:return this.g();case 203:return this.h();case 204:return this.m();case 205:return this.n();case 206:return this.o();case 207:return this.p();case 208:return this.i();case 209:return this.j();case 210:return this.k();case 211:return this.l();case 217:return this.s(this.m());case 218:return this.s(this.n());case 219:return this.s(this.o());case 220:return this.q(this.n());case 221:return this.q(this.o());case 222:return this.r(this.n());case 223:return this.r(this.o());case 196:return this.t(this.m());case 197:return this.t(this.n());case 198:return this.t(this.o());case 212:return this.u(1);case 213:return this.u(2);case 214:return this.u(4);case 215:return this.u(8);case 216:return this.u(16);case 199:return this.u(this.m());case 200:return this.u(this.n());case 201:return this.u(this.o());default:return this.a(0)}}g(){return this.e<this.d+4?this.a(4):(k[0]=16777216*this.c[this.d]|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],this.d+=4,d[0])}h(){return this.e<this.d+8?this.a(8):(S[1]=16777216*this.c[this.d]|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],S[0]=16777216*this.c[this.d+4]|this.c[this.d+5]<<16|this.c[this.d+6]<<8|this.c[this.d+7],this.d+=8,o[0])}m(){if(this.e<=this.d)return this.a(1);const t=this.c[this.d];return this.d+=1,t}n(){if(this.e<this.d+2)return this.a(2);const t=this.c[this.d]<<8|this.c[this.d+1];return this.d+=2,t}o(){if(this.e<this.d+4)return this.a(4);const t=16777216*this.c[this.d]+(this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3]);return this.d+=4,t}p(){return this.e<this.d+8?this.a(8):(U[1]=this.c[this.d]<<24|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],U[0]=this.c[this.d+4]<<24|this.c[this.d+5]<<16|this.c[this.d+6]<<8|this.c[this.d+7],this.d+=8,a[0])}i(){if(this.e<=this.d)return this.a(1);const t=this.c[this.d]-256;return this.d+=1,t}j(){if(this.e<this.d+2)return this.a(2);const t=(this.c[this.d]<<8|this.c[this.d+1])-65536;return this.d+=2,t}k(){if(this.e<this.d+4)return this.a(4);const t=this.c[this.d]<<24|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3];return this.d+=4,t}l(){return this.e<this.d+8?this.a(8):(O[1]=this.c[this.d]<<24|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],O[0]=this.c[this.d+4]<<24|this.c[this.d+5]<<16|this.c[this.d+6]<<8|this.c[this.d+7],this.d+=8,f[0])}t(t){if(this.e<this.d+t)return this.a(t);const s=this.c.byteOffset+this.d;return this.d+=t,new FastBuffer(this.c.buffer,s,t)}s(e){return this.e<this.d+e?this.a(e):function(e,i,r){let h,n='';while(r>i)128>(h=e[i])?(n+=t(h),i+=1):224>h?(n+=t((31&h)<<6|63&e[i+1]),i+=2):(n+=s((15&h)<<12|(63&e[i+1])<<6|63&e[i+2]),i+=3);return n}(this.c,this.d,this.d+=e)}q(t){const s=[];for(let e=0;t>e;e++)s[e]=this.f();return s}r(t){const s={};while(t>0)t-=1,s[this.f()]=this.f();return s}u(t){if(this.e<this.d+t)return this.a(t);const s=this.c[this.d];if(this.d+=1,this.b){const e=this.b.get(s);if(void 0!==e)return e.decode(this,t)}return new F(s,this.c.slice(this.d,this.d+=t))}}export{Decoder,Encoder};
