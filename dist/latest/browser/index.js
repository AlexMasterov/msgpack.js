import{a as t,b as s,c as i,d as e,e as h,f as r,g as n,h as c,i as d,j as u}from'./encoders/index-ef1c553f.js';import'./errors/index.js';import{throwsDecoderHandler as a,throwsEncoderHandler as o}from'./handlers/index.js';const f=(i,e,h)=>{let r,n='';while(h>e)128>(r=i[e])?(n+=t(r),e+=1):224>r?(n+=t((31&r)<<6|63&i[e+1]),e+=2):(n+=s((15&r)<<12|(63&i[e+1])<<6|63&i[e+2]),e+=3);return n},l=s=>{let e='';for(let h,r=0;r<s.length;r++)"">(h=s[r])?e+=h:"ࠀ">h?e+=i[h.charCodeAt(0)]:(h=h.codePointAt(0),e+=t(224|h>>12&15,128|h>>6&63,128|63&h));return e};function b(t,s){this.type=t,this.bin=s}const y=new Uint32Array(e.buffer),g=new Uint32Array(h.buffer),w=new Uint32Array(r.buffer),A=new Int32Array(n.buffer),j=t=>{const s=new Map;let i,e=t.length;while(e>0)i=t[e-=1],s.set(i.type,i);return s};class Decoder{constructor({handler:t=a,codecs:s=!1}={}){this.a=t.bind(this),this.b=s&&j(s),this.c=null,this.d=0,this.e=0}decode(t,s=0,i=t.length){return this.c=t,this.d=s,this.e=s+i,this.f()}f(){if(this.e<=this.d)return this.a(1);const t=this.c[this.d];if(this.d+=1,192>t)return 128>t?t:144>t?128===t?{}:this.r(15&t):160>t?144===t?[]:this.q(15&t):160===t?'':this.s(31&t);if(t>223)return t-256;switch(t){case 192:return null;case 194:return!1;case 195:return!0;case 202:return this.g();case 203:return this.h();case 204:return this.m();case 205:return this.n();case 206:return this.o();case 207:return this.p();case 208:return this.i();case 209:return this.j();case 210:return this.k();case 211:return this.l();case 217:return this.s(this.m());case 218:return this.s(this.n());case 219:return this.s(this.o());case 220:return this.q(this.n());case 221:return this.q(this.o());case 222:return this.r(this.n());case 223:return this.r(this.o());case 196:return this.t(this.m());case 197:return this.t(this.n());case 198:return this.t(this.o());case 212:return this.u(1);case 213:return this.u(2);case 214:return this.u(4);case 215:return this.u(8);case 216:return this.u(16);case 199:return this.u(this.m());case 200:return this.u(this.n());case 201:return this.u(this.o());default:return this.a(0)}}g(){return this.e<this.d+4?this.a(4):(y[0]=16777216*this.c[this.d]|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],this.d+=4,e[0])}h(){return this.e<this.d+8?this.a(8):(g[1]=16777216*this.c[this.d]|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],g[0]=16777216*this.c[this.d+4]|this.c[this.d+5]<<16|this.c[this.d+6]<<8|this.c[this.d+7],this.d+=8,h[0])}m(){if(this.e<=this.d)return this.a(1);const t=this.c[this.d];return this.d+=1,t}n(){if(this.e<this.d+2)return this.a(2);const t=this.c[this.d]<<8|this.c[this.d+1];return this.d+=2,t}o(){if(this.e<this.d+4)return this.a(4);const t=16777216*this.c[this.d]+(this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3]);return this.d+=4,t}p(){return this.e<this.d+8?this.a(8):(w[1]=this.c[this.d]<<24|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],w[0]=this.c[this.d+4]<<24|this.c[this.d+5]<<16|this.c[this.d+6]<<8|this.c[this.d+7],this.d+=8,r[0])}i(){if(this.e<=this.d)return this.a(1);const t=this.c[this.d]-256;return this.d+=1,t}j(){if(this.e<this.d+2)return this.a(2);const t=(this.c[this.d]<<8|this.c[this.d+1])-65536;return this.d+=2,t}k(){if(this.e<this.d+4)return this.a(4);const t=this.c[this.d]<<24|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3];return this.d+=4,t}l(){return this.e<this.d+8?this.a(8):(A[1]=this.c[this.d]<<24|this.c[this.d+1]<<16|this.c[this.d+2]<<8|this.c[this.d+3],A[0]=this.c[this.d+4]<<24|this.c[this.d+5]<<16|this.c[this.d+6]<<8|this.c[this.d+7],this.d+=8,n[0])}t(t){if(this.e<this.d+t)return this.a(t);const s=this.c.byteOffset+this.d;return this.d+=t,new Uint8Array(this.c.buffer,s,t)}s(t){return this.e<this.d+t?this.a(t):f(this.c,this.d,this.d+=t)}q(t){const s=[];for(let i=0;t>i;i++)s[i]=this.f();return s}r(t){const s={};while(t>0)t-=1,s[this.f()]=this.f();return s}u(t){if(this.e<this.d+t)return this.a(t);const s=this.c[this.d];if(this.d+=1,this.b){const i=this.b.get(s);if(void 0!==i)return i.decode(this,t)}return new b(s,this.c.slice(this.d,this.d+=t))}}const m=new Uint8Array(r.buffer),p=new Int8Array(n.buffer),I='boolean',x='number',B='object',U='string',q='bigint';class Encoder{constructor({handler:t=o,codecs:s=!1,float:i="64",objectKey:e="ascii",objectCase:h=Object.keys,arrayCase:r=Array.isArray}={}){this.b=t.bind(this),this.a=s,this.encodeFloat=c(i),this.c='ascii'===e?d:this.encodeStr,this.d=h,this.e=r}encode(t){switch(typeof t){case U:return this.encodeStr(t);case x:return t%1==0?this.encodeInt(t):this.encodeFloat(t);case B:if(null===t)return'À';if(this.e(t))return this.encodeArray(t);if(isBuffer(t))return this.encodeBin(t);if(t.constructor==b)return this.encodeExt(t.type,t.bin);if(this.a){let s,i=this.a.length;while(i>0)if(null!==(s=this.a[i-=1].encode(this,t)))return s}return this.encodeObject(t);case I:return t?'Ã':'Â';case q:return t>4294967295||-2147483648>t?this.encodeBigInt(t):this.encodeInt(+t);default:return this.b(t)}}encodeNil(){return'À'}encodeBool(t){return t?'Ã':'Â'}encodeInt(s){return 0>s?s>-33?t(255&s):s>-129?'Ð'+t(255&s):s>-32769?'Ñ'+t(s>>8&255)+t(255&s):s>-2147483649?'Ò'+t(s>>24&255)+t(s>>16&255)+t(s>>8&255)+t(255&s):s>-9007199254740992?'Ó'+u((s/4294967296>>0)-1,s>>>0):'Ëÿð\0\0\0\0\0\0':128>s?t(s):256>s?'Ì'+t(s):65536>s?'Í'+t(s>>8)+t(255&s):4294967296>s?'Î'+t(s>>24&255)+t(s>>16&255)+t(s>>8&255)+t(255&s):9007199254740992>s?'Ï'+u(s>>>11|1,s):'Ëð\0\0\0\0\0\0'}encodeBigInt(s){return 0>s?(n[0]=s,'Ó'+t(255&p[7])+t(255&p[6])+t(255&p[5])+t(255&p[4])+t(255&p[3])+t(255&p[2])+t(255&p[1])+t(255&p[0])):(r[0]=s,'Ï'+t(m[7])+t(m[6])+t(m[5])+t(m[4])+t(m[3])+t(m[2])+t(m[1])+t(m[0]))}encodeStr(s){let i=s.length;if(0===i)return' ';const e=l(s);return 32>(i=e.length)?t(160|i)+e:256>i?'Ù'+t(i)+e:65536>i?'Ú'+t(i>>8)+t(255&i)+e:'Û'+t(i>>24&255)+t(i>>16&255)+t(i>>8&255)+t(255&i)+e}encodeBin(s){const i=s.length;if(0===i)return'Ä\0';let e='';for(let h=0;i>h;h++)e+=t(s[h]);return 256>i?'Ä'+t(i)+e:65536>i?'Å'+t(i>>8)+t(255&i)+e:'Æ'+t(i>>24&255)+t(i>>16&255)+t(i>>8&255)+t(255&i)+e}encodeArray(s){const i=s.length;if(0===i)return'';let e;e=16>i?t(144|i):65536>i?'Ü'+t(i>>8)+t(255&i):'Ý'+t(i>>24&255)+t(i>>16&255)+t(i>>8&255)+t(255&i);for(let t=0;i>t;t++)e+=this.encode(s[t]);return e}encodeObject(s){const i=this.d(s),e=i.length;if(0===e)return'';let h;h=16>e?t(128|e):65536>e?'Þ'+t(e>>8)+t(255&e):'ß'+t(e>>24&255)+t(e>>16&255)+t(e>>8&255)+t(255&e);for(let t,r=0;e>r;r++)t=i[r],h+=this.c(t),h+=this.encode(s[t]);return h}encodeExt(s,i){const e=t(127&s)+i,h=i.length;switch(h){case 1:return'Ô'+e;case 2:return'Õ'+e;case 4:return'Ö'+e;case 8:return'×'+e;case 16:return'Ø'+e}return 256>h?'Ç'+t(h)+e:65536>h?'È'+t(h>>8)+t(255&h)+e:'É'+t(h>>24&255)+t(h>>16&255)+t(h>>8&255)+t(255&h)+e}}export{Decoder,Encoder,b as Ext};
